/* Styles pour préserver les couleurs personnalisées dans l'éditeur de texte */

/* Mode clair: s'assurer que les couleurs personnalisées sont préservées */
.ProseMirror [style*="color:"],
.ProseMirror span[style*="color:"],
.ProseMirror p[style*="color:"],
.ProseMirror h1[style*="color:"],
.ProseMirror h2[style*="color:"],
.ProseMirror h3[style*="color:"],
.ProseMirror strong[style*="color:"],
.ProseMirror em[style*="color:"],
.ProseMirror li[style*="color:"] {
  color: inherit !important;
}

.ProseMirror [style*="background-color:"],
.ProseMirror span[style*="background-color:"],
.ProseMirror p[style*="background-color:"],
.ProseMirror h1[style*="background-color:"],
.ProseMirror h2[style*="background-color:"],
.ProseMirror h3[style*="background-color:"],
.ProseMirror strong[style*="background-color:"],
.ProseMirror em[style*="background-color:"],
.ProseMirror li[style*="background-color:"] {
  background-color: inherit !important;
}

/* Mode sombre: s'assurer que les couleurs personnalisées sont préservées */
html[data-theme="dark"] .ProseMirror [style*="color:"],
html[data-theme="dark"] .ProseMirror span[style*="color:"],
html[data-theme="dark"] .ProseMirror p[style*="color:"],
html[data-theme="dark"] .ProseMirror h1[style*="color:"],
html[data-theme="dark"] .ProseMirror h2[style*="color:"],
html[data-theme="dark"] .ProseMirror h3[style*="color:"],
html[data-theme="dark"] .ProseMirror strong[style*="color:"],
html[data-theme="dark"] .ProseMirror em[style*="color:"],
html[data-theme="dark"] .ProseMirror li[style*="color:"] {
  color: inherit !important;
}

html[data-theme="dark"] .ProseMirror [style*="background-color:"],
html[data-theme="dark"] .ProseMirror span[style*="background-color:"],
html[data-theme="dark"] .ProseMirror p[style*="background-color:"],
html[data-theme="dark"] .ProseMirror h1[style*="background-color:"],
html[data-theme="dark"] .ProseMirror h2[style*="background-color:"],
html[data-theme="dark"] .ProseMirror h3[style*="background-color:"],
html[data-theme="dark"] .ProseMirror strong[style*="background-color:"],
html[data-theme="dark"] .ProseMirror em[style*="background-color:"],
html[data-theme="dark"] .ProseMirror li[style*="background-color:"] {
  background-color: inherit !important;
}

/* Amélioration des surlignages */
.ProseMirror mark[style],
.ProseMirror span[data-highlight] {
  background-color: inherit !important;
  mix-blend-mode: multiply !important;
}

html[data-theme="dark"] .ProseMirror mark[style],
html[data-theme="dark"] .ProseMirror span[data-highlight] {
  mix-blend-mode: screen !important;
  opacity: 0.85 !important;
}

/* Forcer des contrastes suffisants pour les couleurs claires sur fond sombre */
html[data-theme="dark"] .ProseMirror [style*="color: #fff"],
html[data-theme="dark"] .ProseMirror [style*="color: white"],
html[data-theme="dark"] .ProseMirror [style*="color: #ffffff"],
html[data-theme="dark"] .ProseMirror [style*="color:#fff"],
html[data-theme="dark"] .ProseMirror [style*="color:#ffffff"],
html[data-theme="dark"] .ProseMirror [style*="color:white"] {
  text-shadow: 0px 0px 1px rgba(0, 0, 0, 0.8) !important;
}

/* Préserver les couleurs de fond claires avec opacité réduite en mode sombre */
html[data-theme="dark"] .ProseMirror mark[style*="background-color: #f"],
html[data-theme="dark"] .ProseMirror span[style*="background-color: #f"] {
  opacity: 0.7 !important;
  mix-blend-mode: screen !important;
}

/* Assurer que le mode de surbrillance fonctionne correctement */
.has-highlight {
  background-color: inherit !important;
}

/* Correction pour TipTap ColorExtension et Highlight */
.ProseMirror .has-highlight {
  background-color: inherit !important;
}

html[data-theme="dark"] .ProseMirror p[class] {
  color: inherit !important;
}

/* Correction importante: fournir un mode de mixage compatible pour préserver la lisibilité des couleurs */
html[data-theme="dark"] .ProseMirror [style] {
  color: inherit !important;
  background-color: inherit !important;
}

/* Modifications pour préserver les styles pendant l'édition active */

/* Supprimer les règles qui pourraient interférer avec la visibilité pendant l'édition */
.ProseMirror [style],
.ProseMirror span[style],
.ProseMirror p[style],
.ProseMirror h1[style],
.ProseMirror h2[style],
.ProseMirror h3[style],
.ProseMirror strong[style],
.ProseMirror em[style],
.ProseMirror li[style] {
  color: unset !important;
  background-color: unset !important;
}

/* Important: assurer que les couleurs spécifiées par l'extension Color sont visibles pendant l'édition */
.ProseMirror [style*="color:"] {
  color: var(--color) !important;
}

/* Important: assurer que les couleurs de fond sont visibles pendant l'édition */
.ProseMirror mark[style*="background-color:"],
.ProseMirror span[style*="background-color:"] {
  background-color: var(--bg-color) !important;
  mix-blend-mode: unset !important;
}

/* Règles spécifiques pour le mode sombre pendant l'édition */
html[data-theme="dark"] .ProseMirror [style*="color:"] {
  color: var(--color) !important;
}

html[data-theme="dark"] .ProseMirror mark[style*="background-color:"],
html[data-theme="dark"] .ProseMirror span[style*="background-color:"] {
  background-color: var(--bg-color) !important;
  opacity: 0.85 !important;
  mix-blend-mode: screen !important;
}

/* Forcer l'affichage des styles personnalisés pendant l'édition */
.ProseMirror [style*="color:"] {
  --color: attr(style color);
}

.ProseMirror [style*="background-color:"] {
  --bg-color: attr(style background-color);
}

/* Réglages spécifiques pour les extensions TipTap pendant l'édition */
.ProseMirror .has-highlight {
  mix-blend-mode: unset !important;
}

html[data-theme="dark"] .ProseMirror .has-highlight {
  mix-blend-mode: screen !important;
}

/* Correction spécifique pour les textes colorés pendant l'édition */
.ProseMirror [data-text-color] {
  color: attr(data-text-color) !important;
}

.ProseMirror [data-highlight-color] {
  background-color: attr(data-highlight-color) !important;
}

/* Assurez-vous que les règles génériques n'interfèrent pas avec les couleurs pendant l'édition */
html[data-theme="dark"] .ProseMirror p {
  color: unset;  /* Laisser la couleur être déterminée par les styles inline */
}

/* Règles critiques pour la visibilité immédiate des styles en mode sombre pendant l'édition */
html[data-theme="dark"] .ProseMirror [style]:not([style=""]) {
  all: revert !important;  /* Reset complet pour les éléments stylisés */
}

html[data-theme="dark"] .ProseMirror [style*="color:"] {
  color: currentColor !important;  /* Préserver la couleur actuelle */
}

html[data-theme="dark"] .ProseMirror [style*="background-color:"] {
  background-color: currentColor !important;  /* Préserver la couleur de fond actuelle */
}
