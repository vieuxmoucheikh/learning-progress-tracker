<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Progress Tracker</title>
    <!-- Assurer que le mode clair s'applique correctement sur mobile -->
    <meta name="color-scheme" content="light dark" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#f8fafc"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#1e293b"
    />
    <!-- STYLE ULTRA-PRIORITAIRE pour corriger les cartes en mode clair sur mobile -->
    <style>
      :root {
        color-scheme: light dark;
      }

      /* Transition fluide entre les modes */
      html,
      body,
      #root,
      .card,
      [class*="card"] {
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      @media (max-width: 768px) {
        /* MODE CLAIR - AMÉLIORATIONS CRITIQUES */
        html[data-theme="light"] .card,
        html[data-theme="light"] [class*="Card"],
        html[data-theme="light"] [class*="-card"],
        html[data-theme="light"] [class*="card"],
        html[data-theme="light"] .mastered-card,
        html[data-theme="light"] [class*="learning-item-card"],
        html[data-theme="light"] [class*="active-tasks"] .card,
        html[data-theme="light"] [class*="completed-today"] .card,
        html[data-theme="light"] [role="tabpanel"][id*="items"] .card {
          background-color: #ffffff !important;
          background: #ffffff !important;
          border: 1px solid rgba(0, 0, 0, 0.15) !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
        }

        /* Styles de texte en mode clair */
        html[data-theme="light"] .card h3,
        html[data-theme="light"] .card h4,
        html[data-theme="light"] .card [class*="title"],
        html[data-theme="light"] .card [class*="heading"],
        html[data-theme="light"] [class*="card"] h3,
        html[data-theme="light"] [class*="card"] h4,
        html[data-theme="light"] [class*="card"] [class*="title"],
        html[data-theme="light"] [class*="card"] [class*="heading"] {
          color: #111827 !important;
          font-weight: 600 !important;
        }

        html[data-theme="light"] .card p,
        html[data-theme="light"] .card [class*="description"],
        html[data-theme="light"] .card [class*="text"],
        html[data-theme="light"] [class*="card"] p,
        html[data-theme="light"] [class*="card"] [class*="description"],
        html[data-theme="light"] [class*="card"] [class*="text"],
        html[data-theme="light"] [class*="organize-text"],
        html[data-theme="light"] [class*="learning-description"] {
          color: #374151 !important;
          opacity: 1 !important;
          visibility: visible !important;
        }

        /* MODE SOMBRE */
        html[data-theme="dark"] .card,
        html[data-theme="dark"] [class*="Card"],
        html[data-theme="dark"] [class*="-card"],
        html[data-theme="dark"] [class*="card"] {
          background-color: #1e293b !important;
          background: #1e293b !important;
          border-color: rgba(255, 255, 255, 0.1) !important;
        }

        /* Préserver les couleurs des éléments importants */
        svg,
        [class*="lucide-"],
        .preserve-color,
        [class*="bg-blue-"],
        [class*="bg-green-"],
        [class*="bg-red-"],
        [class*="bg-yellow-"] {
          color: currentColor !important;
        }

        /* Assurer la bonne coloration des boutons */
        .bg-blue-500,
        .bg-green-500,
        .bg-red-500 {
          color: #ffffff !important;
        }

        /* Fixer les badges en mode clair */
        html[data-theme="light"] [class*="badge"],
        html[data-theme="light"] [class*="tag"],
        html[data-theme="light"] .card-tags span {
          background-color: #f3f4f6 !important;
          color: #1f2937 !important;
          border: 1px solid #d1d5db !important;
          opacity: 1 !important;
          visibility: visible !important;
        }

        /* Icônes en mode clair */
        html[data-theme="light"] .card svg,
        html[data-theme="light"] [class*="card"] svg,
        html[data-theme="light"] .card [class*="icon"],
        html[data-theme="light"] [class*="card"] [class*="icon"] {
          color: #4b5563 !important;
          fill: #4b5563 !important;
          stroke: #4b5563 !important;
        }

        /* Améliorations spécifiques pour les sections Completed Today et Active Tasks */
        html[data-theme="light"] [class*="completed-today"] .card,
        html[data-theme="light"] [class*="active-tasks"] .card,
        html:not([data-theme="dark"]) [class*="completed-today"] .card,
        html:not([data-theme="dark"]) [class*="active-tasks"] .card {
          background-color: #ffffff !important;
          border: 1px solid #d1d5db !important;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important;
        }

        html[data-theme="light"] [class*="completed-today"] h3,
        html[data-theme="light"] [class*="active-tasks"] h3,
        html:not([data-theme="dark"]) [class*="completed-today"] h3,
        html:not([data-theme="dark"]) [class*="active-tasks"] h3 {
          color: #111827 !important;
          font-weight: 600 !important;
        }

        html[data-theme="light"] [class*="completed-today"] p,
        html[data-theme="light"] [class*="active-tasks"] p,
        html:not([data-theme="dark"]) [class*="completed-today"] p,
        html:not([data-theme="dark"]) [class*="active-tasks"] p {
          color: #374151 !important;
          opacity: 1 !important;
          visibility: visible !important;
        }

        /* Corrections pour l'onglet Items */
        html[data-theme="light"] [id*="items-tab"] .card,
        html:not([data-theme="dark"]) [id*="items-tab"] .card {
          background-color: #ffffff !important;
          border: 1px solid #d1d5db !important;
        }

        /* STYLE CRITIQUE POUR LES CARTES - PRIORITÉ MAX */
        html[data-theme="light"] .learning-item-card,
        html[data-theme="light"] [class*="learning-item-card"],
        html[data-theme="light"] [class*="learning-card"],
        html[data-theme="light"] .card,
        html[data-theme="light"] [class*="completed-today"] .card,
        html[data-theme="light"] [class*="active-tasks"] .card,
        html[data-theme="light"] [role="tabpanel"] .card,
        html:not([data-theme="dark"]) .learning-item-card,
        html:not([data-theme="dark"]) [class*="learning-item-card"],
        html:not([data-theme="dark"]) [class*="learning-card"],
        html:not([data-theme="dark"]) .card,
        html:not([data-theme="dark"]) [class*="completed-today"] .card,
        html:not([data-theme="dark"]) [class*="active-tasks"] .card,
        html:not([data-theme="dark"]) [role="tabpanel"] .card {
          background-color: #ffffff !important;
          background: #ffffff !important;
          border: 2px solid #d1d5db !important;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12) !important;
          color: #1f2937 !important;
          position: relative;
        }

        html[data-theme="light"] .card h3,
        html[data-theme="light"] .card h4,
        html[data-theme="light"] .card [class*="title"],
        html[data-theme="light"] .card [class*="heading"],
        html:not([data-theme="dark"]) .card h3,
        html:not([data-theme="dark"]) .card h4,
        html:not([data-theme="dark"]) .card [class*="title"],
        html:not([data-theme="dark"]) .card [class*="heading"] {
          color: #000000 !important;
          font-weight: 700 !important;
          text-shadow: none !important;
        }

        html[data-theme="light"] .card p,
        html[data-theme="light"] .card [class*="text"],
        html[data-theme="light"] .card [class*="description"],
        html:not([data-theme="dark"]) .card p,
        html:not([data-theme="dark"]) .card [class*="text"],
        html:not([data-theme="dark"]) .card [class*="description"] {
          color: #111827 !important;
          font-weight: 500 !important;
          opacity: 1 !important;
          visibility: visible !important;
        }

        html[data-theme="light"] .card [class*="badge"],
        html[data-theme="light"] .card [class*="tag"],
        html:not([data-theme="dark"]) .card [class*="badge"],
        html:not([data-theme="dark"]) .card [class*="tag"] {
          background-color: #e5e7eb !important;
          color: #000000 !important;
          border: 1px solid #9ca3af !important;
          font-weight: 600 !important;
        }

        html[data-theme="light"] .card svg,
        html[data-theme="light"] .card [class*="icon"],
        html:not([data-theme="dark"]) .card svg,
        html:not([data-theme="dark"]) .card [class*="icon"] {
          color: #000000 !important;
          stroke: #000000 !important;
          stroke-width: 2px !important;
          fill: none !important;
        }
      }
    </style>
    <link rel="stylesheet" href="/emergency-mobile-fix.css" />
    <link rel="stylesheet" href="/mobile-light-mode.css" />
    <link rel="stylesheet" href="/emergency-light-card-fix.css" />
    <link rel="stylesheet" href="/final-light-mode-fix.css" />
    <link rel="stylesheet" href="/unified-mobile-light-mode.css" />
    <script src="/light-mode-fixer.js" defer></script>
    <script src="/unified-light-mode-fixer.js" defer></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script src="/fix-light-cards.js" defer></script>
    <script src="/direct-card-fixer.js" defer></script>
    <!-- Script d'urgence pour corriger les cartes au chargement -->
    <script>
      (function () {
        // Fonction pour appliquer les correctifs immédiats aux cartes
        function applyEmergencyLightModeCardFixes() {
          if (window.innerWidth <= 768) {
            const isLightMode =
              document.documentElement.getAttribute("data-theme") === "light" ||
              !document.documentElement.classList.contains("dark");

            if (isLightMode) {
              // Sélecteurs pour les sections critiques
              const criticalSelectors = [
                '[class*="completed-today"] .card',
                '[class*="active-tasks"] .card',
                '[id*="dashboard"] .card',
                '[id*="items-tab"] .card',
                ".learning-item-card",
                '[class*="learning-item-card"]',
              ];

              document
                .querySelectorAll(criticalSelectors.join(","))
                .forEach((card) => {
                  // Appliquer les styles d'urgence
                  card.style.backgroundColor = "#ffffff";
                  card.style.border = "1px solid #d1d5db";
                  card.style.color = "#374151";

                  // Trouver et corriger tous les éléments textuels
                  card
                    .querySelectorAll(
                      'h3, h4, p, [class*="text"], [class*="title"], [class*="description"]'
                    )
                    .forEach((el) => {
                      el.style.color = el.tagName.toLowerCase().startsWith("h")
                        ? "#111827"
                        : "#374151";
                      el.style.opacity = "1";
                      el.style.visibility = "visible";
                    });
                });
            }
          }
        }

        // Appliquer immédiatement
        if (document.readyState === "loading") {
          document.addEventListener(
            "DOMContentLoaded",
            applyEmergencyLightModeCardFixes
          );
        } else {
          applyEmergencyLightModeCardFixes();
        }

        // Réappliquer lors du chargement complet
        window.addEventListener("load", applyEmergencyLightModeCardFixes);

        // Réappliquer lors des changements
        window.addEventListener("resize", applyEmergencyLightModeCardFixes);

        // Observer les changements de thème
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (
              mutation.attributeName === "data-theme" ||
              mutation.attributeName === "class"
            ) {
              applyEmergencyLightModeCardFixes();
            }
          });
        });

        observer.observe(document.documentElement, { attributes: true });
      })();
    </script>
    <!-- Script d'urgence inline pour application immédiate -->
    <script>
      (function () {
        // Fonction d'urgence pour forcer immédiatement les styles des cartes
        function emergencyCardFix() {
          if (window.innerWidth <= 768) {
            const isLightMode =
              document.documentElement.getAttribute("data-theme") === "light" ||
              !document.documentElement.classList.contains("dark");

            if (isLightMode) {
              console.log("🚨 EMERGENCY CARD FIX APPLIED");

              // Sélecteurs de cartes ultra-génériques
              const allCardElements = document.querySelectorAll(
                '.card, [class*="card"], .learning-item-card, [class*="learning-item-card"]'
              );

              allCardElements.forEach((card) => {
                // Style de base
                card.style.backgroundColor = "#ffffff";
                card.style.border = "2px solid #d1d5db";
                card.style.color = "#000000";

                // Titres
                card
                  .querySelectorAll(
                    'h3, h4, [class*="title"], [class*="heading"]'
                  )
                  .forEach((el) => {
                    el.style.color = "#000000";
                    el.style.fontWeight = "bold";
                  });

                // Texte
                card
                  .querySelectorAll(
                    'p, [class*="text"], [class*="description"]'
                  )
                  .forEach((el) => {
                    el.style.color = "#111827";
                    el.style.opacity = "1";
                    el.style.fontWeight = "500";
                  });

                // Icônes
                card.querySelectorAll('svg, [class*="icon"]').forEach((el) => {
                  el.style.color = "#000000";
                  el.style.stroke = "#000000";
                });
              });

              // Sections spécifiques
              document
                .querySelectorAll(
                  '[class*="completed-today"] h3, [class*="active-tasks"] h3'
                )
                .forEach((el) => {
                  el.style.color = "#000000";
                  el.style.fontWeight = "bold";
                });
            }
          }
        }

        // Exécuter immédiatement
        emergencyCardFix();

        // Exécuter après un court délai
        setTimeout(emergencyCardFix, 500);

        // Exécuter après le chargement
        window.addEventListener("load", emergencyCardFix);
      })();
    </script>
    <!-- Script pour garantir la visibilité des cartes après le chargement complet -->
    <script>
      (function () {
        function applyFinalFix() {
          if (window.innerWidth <= 768) {
            const isLightMode =
              document.documentElement.getAttribute("data-theme") === "light" ||
              !document.documentElement.classList.contains("dark");

            if (isLightMode) {
              // Sélecteurs très ciblés pour tous les types de cartes
              const cardSelectors = [
                ".learning-item-card",
                '[class*="learning-item-card"]',
                '[class*="learning-card"]',
                '[class*="dashboard"] .card',
                '[class*="completed-today"] .card',
                '[class*="active-tasks"] .card',
                '[role="tabpanel"][id*="items"] .card',
                '[id*="items-tab"] .card',
              ];

              // Appliquer les styles directement en JavaScript
              document
                .querySelectorAll(cardSelectors.join(", "))
                .forEach((card) => {
                  // Style de base de carte
                  card.style.backgroundColor = "#ffffff";
                  card.style.border = "2px solid #94a3b8";
                  card.style.boxShadow = "0 4px 10px rgba(0, 0, 0, 0.1)";
                  card.style.color = "#0f172a";
                  card.style.position = "relative";
                  card.style.zIndex = "1";

                  // Style de tous les titres
                  card
                    .querySelectorAll(
                      'h1, h2, h3, h4, [class*="title"], [class*="heading"]'
                    )
                    .forEach((title) => {
                      title.style.color = "#000000";
                      title.style.fontWeight = "700";
                      title.style.textShadow = "none";
                      title.style.opacity = "1";
                      title.style.visibility = "visible";
                    });

                  // Style de tous les paragraphes
                  card
                    .querySelectorAll(
                      'p, [class*="text"], [class*="description"]'
                    )
                    .forEach((text) => {
                      text.style.color = "#000000";
                      text.style.fontWeight = "500";
                      text.style.opacity = "1";
                      text.style.visibility = "visible";
                    });
                });
            }
          }
        }

        // Exécuter immédiatement
        applyFinalFix();

        // Exécuter après un court délai
        setTimeout(applyFinalFix, 500);

        // Exécuter après le chargement complet
        window.addEventListener("load", () => {
          applyFinalFix();
          // Réessayer plusieurs fois après le chargement
          setTimeout(applyFinalFix, 1000);
          setTimeout(applyFinalFix, 2000);
        });

        // Exécuter lors du changement de thème
        const observer = new MutationObserver((mutations) => {
          for (const mutation of mutations) {
            if (
              mutation.attributeName === "data-theme" ||
              mutation.attributeName === "class"
            ) {
              applyFinalFix();
            }
          }
        });

        observer.observe(document.documentElement, { attributes: true });
      })();
    </script>
    <!-- Script final d'urgence avec priorité maximale pour les cartes -->
    <script>
      (function () {
        // Fonction pour corriger définitivement les cartes en mode clair sur mobile
        function ultimateCardFixer() {
          // Vérifier si on est en mode clair sur mobile
          if (window.innerWidth <= 768) {
            const isLightMode =
              document.documentElement.getAttribute("data-theme") === "light" ||
              !document.documentElement.classList.contains("dark");

            if (isLightMode) {
              console.log("📱⚡ CRITICAL CARD FIX ACTIVATED");

              // Sélecteurs pour tous les types de cartes et éléments importants
              const criticalSelectors = [
                ".card",
                '[class*="card"]',
                ".learning-item-card",
                '[class*="learning-item-card"]',
                '[class*="completed-today"] .card',
                '[class*="active-tasks"] .card',
                '[role="tabpanel"] .card',
                '[id*="items-tab"] .card',
                '[id*="dashboard"] .card',
                '[class*="learning-card"]',
              ];

              // Appliquer des styles directs avec priorité maximale
              document
                .querySelectorAll(criticalSelectors.join(","))
                .forEach((card) => {
                  // Styles de base avec setProperty pour priorité maximale
                  card.style.setProperty(
                    "background-color",
                    "#ffffff",
                    "important"
                  );
                  card.style.setProperty("background", "#ffffff", "important");
                  card.style.setProperty(
                    "border",
                    "2px solid #94a3b8",
                    "important"
                  );
                  card.style.setProperty(
                    "box-shadow",
                    "0 4px 8px rgba(0, 0, 0, 0.15)",
                    "important"
                  );
                  card.style.setProperty("color", "#000000", "important");
                  card.style.setProperty("position", "relative", "important");
                  card.style.setProperty("z-index", "1", "important");

                  // Titres
                  card
                    .querySelectorAll(
                      'h1, h2, h3, h4, h5, h6, [class*="title"], [class*="heading"]'
                    )
                    .forEach((heading) => {
                      heading.style.setProperty(
                        "color",
                        "#000000",
                        "important"
                      );
                      heading.style.setProperty(
                        "font-weight",
                        "700",
                        "important"
                      );
                      heading.style.setProperty("opacity", "1", "important");
                      heading.style.setProperty(
                        "visibility",
                        "visible",
                        "important"
                      );
                      heading.style.setProperty(
                        "text-shadow",
                        "none",
                        "important"
                      );
                    });

                  // Textes
                  card
                    .querySelectorAll(
                      'p, [class*="text"], [class*="description"]'
                    )
                    .forEach((text) => {
                      text.style.setProperty("color", "#000000", "important");
                      text.style.setProperty("opacity", "1", "important");
                      text.style.setProperty(
                        "visibility",
                        "visible",
                        "important"
                      );
                    });

                  // Icônes
                  card
                    .querySelectorAll('svg, [class*="icon"]')
                    .forEach((icon) => {
                      icon.style.setProperty("color", "#000000", "important");
                      icon.style.setProperty("stroke", "#000000", "important");
                      icon.style.setProperty(
                        "stroke-width",
                        "2.5px",
                        "important"
                      );
                    });
                });
            }
          }
        }

        // Application immédiate
        ultimateCardFixer();

        // Application après un délai (pour les contenus dynamiques)
        setTimeout(ultimateCardFixer, 100);
        setTimeout(ultimateCardFixer, 500);
        setTimeout(ultimateCardFixer, 2000);

        // Application après chargement complet
        window.addEventListener("load", () => {
          ultimateCardFixer();
          setTimeout(ultimateCardFixer, 1000);
        });

        // Surveiller les changements de thème
        const observer = new MutationObserver(() => ultimateCardFixer());
        observer.observe(document.documentElement, { attributes: true });

        // Surveiller les clics pour les changements d'onglet
        document.addEventListener("click", () =>
          setTimeout(ultimateCardFixer, 300)
        );
      })();
    </script>
  </body>
</html>
